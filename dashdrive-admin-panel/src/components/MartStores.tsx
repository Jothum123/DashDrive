import React, { useState } from 'react';
import {
    Search,
    Filter,
    Plus,
    Building,
    Store,
    MapPin,
    Star,
    CheckCircle2,
    XCircle,
    MoreVertical,
    TrendingUp,
    Users,
    Wallet,
    Calendar,
    ArrowUpRight,
    ShoppingBag,
    Clock,
    AlertCircle,
    Eye
} from 'lucide-react';
import { cn } from '../utils';

interface MartStore {
    id: string;
    name: string;
    owner: string;
    zone: string;
    status: 'Active' | 'Pending' | 'Suspended';
    totalOrders: string;
    rating: number;
    earnings: string;
    inventoryStatus: 'Up to Date' | 'Low Stock' | 'OOS Alerts';
    commission: string;
    logo: string;
}

const mockMartStores: MartStore[] = [
    {
        id: 'STR-901',
        name: 'Fresh Mart Supermarket',
        owner: 'John Anderson',
        zone: 'Gulshan 2',
        status: 'Active',
        totalOrders: '1,248',
        rating: 4.8,
        earnings: '$12,450',
        inventoryStatus: 'Up to Date',
        commission: '12%',
        logo: 'https://logo.clearbit.com/kroger.com'
    },
    {
        id: 'STR-902',
        name: 'Daily Needs Express',
        owner: 'Sarah Connor',
        zone: 'Banani',
        status: 'Pending',
        totalOrders: '0',
        rating: 0.0,
        earnings: '$0',
        inventoryStatus: 'Up to Date',
        commission: '15%',
        logo: 'https://logo.clearbit.com/tesco.com'
    },
    {
        id: 'STR-903',
        name: 'Organic Greens Co.',
        owner: 'Alice Wong',
        zone: 'Dhanmondi',
        status: 'Active',
        totalOrders: '842',
        rating: 4.9,
        earnings: '$8,920',
        inventoryStatus: 'Low Stock',
        commission: '10%',
        logo: 'https://logo.clearbit.com/wholefoodsmarket.com'
    },
    {
        id: 'STR-904',
        name: 'Prime Liquor & Snacks',
        owner: 'Bob Marley',
        zone: 'Airport',
        status: 'Suspended',
        totalOrders: '312',
        rating: 3.5,
        earnings: '$2,100',
        inventoryStatus: 'OOS Alerts',
        commission: '18%',
        logo: 'https://logo.clearbit.com/bevmo.com'
    }
];

export const MartStores: React.FC = () => {
    const [activeTab, setActiveTab] = useState('All');
    const [searchQuery, setSearchQuery] = useState('');

    const tabs = ['All', 'Pending Approval', 'Active', 'Suspended'];

    return (
        <div className="space-y-8">
            {/* Header & Stats Section */}
            <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div>
                    <h2 className="text-3xl font-display font-black text-slate-900 tracking-tight">Store Management</h2>
                    <p className="text-sm text-slate-400 font-medium mt-1">Administer grocery partners, approvals, and performance metrics</p>
                </div>
                <button className="flex items-center gap-2.5 px-8 py-3 bg-primary text-white rounded-2xl text-[11px] font-bold font-small-caps tracking-widest shadow-xl shadow-primary/20 hover:scale-105 active:scale-95 transition-all">
                    <Plus className="w-5 h-5" />
                    Onboard New Store
                </button>
            </div>

            {/* KPI Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <StoreKPICard title="Total Partners" value="1,240" icon={<Store />} trend="+12 this week" color="primary" />
                <StoreKPICard title="Pending Requests" value="18" icon={<AlertCircle />} trend="Requires action" color="orange" />
                <StoreKPICard title="Active Earnings" value="$1.2M" icon={<Wallet />} trend="+8.4% vs last mo" color="emerald" />
                <StoreKPICard title="Avg Partner Rating" value="4.75" icon={<Star />} trend="Top tier service" color="blue" />
            </div>

            {/* Search & Tabs Bar */}
            <div className="bg-white p-6 rounded-[32px] shadow-soft border border-slate-100/50 flex flex-col md:flex-row items-center justify-between gap-6">
                <div className="flex bg-slate-100 p-1.5 rounded-2xl w-full md:w-fit overflow-x-auto scrollbar-hide border border-slate-200/30">
                    {tabs.map((tab) => (
                        <button
                            key={tab}
                            onClick={() => setActiveTab(tab)}
                            className={cn(
                                "px-6 py-2.5 rounded-xl text-[10px] font-bold font-small-caps tracking-widest transition-all whitespace-nowrap",
                                activeTab === tab
                                    ? "bg-white text-primary shadow-sm border border-slate-200/50"
                                    : "text-slate-500 hover:text-slate-700 hover:bg-white/30"
                            )}
                        >
                            {tab}
                        </button>
                    ))}
                </div>
                <div className="relative w-full md:w-96 group">
                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-400 group-focus-within:text-primary transition-colors" />
                    <input
                        type="text"
                        placeholder="Search by store name, owner, or zone..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        className="w-full pl-12 pr-6 py-3.5 bg-slate-50 border border-slate-100 rounded-2xl text-sm font-medium focus:bg-white focus:border-primary/30 outline-none transition-all"
                    />
                </div>
            </div>

            {/* Stores List Table */}
            <div className="bg-white rounded-[32px] shadow-soft border border-slate-100/50 overflow-hidden">
                <div className="overflow-x-auto">
                    <table className="w-full text-left border-collapse">
                        <thead>
                            <tr className="border-b border-slate-50 bg-slate-50/30">
                                <th className="px-8 py-5 text-[10px] font-bold text-slate-400 font-small-caps tracking-[0.2em]">Store Information</th>
                                <th className="px-8 py-5 text-[10px] font-bold text-slate-400 font-small-caps tracking-[0.2em]">Zone & Performance</th>
                                <th className="px-8 py-5 text-[10px] font-bold text-slate-400 font-small-caps tracking-[0.2em]">Inventory Health</th>
                                <th className="px-8 py-5 text-[10px] font-bold text-slate-400 font-small-caps tracking-[0.2em]">Economics</th>
                                <th className="px-8 py-5 text-[10px] font-bold text-slate-400 font-small-caps tracking-[0.2em]">Status</th>
                                <th className="px-8 py-5 text-[10px] font-bold text-slate-400 font-small-caps tracking-[0.2em]">Actions</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-50">
                            {mockMartStores.map((store) => (
                                <tr key={store.id} className="hover:bg-slate-50/50 transition-colors group">
                                    <td className="px-8 py-6">
                                        <div className="flex items-center gap-4">
                                            <img src={store.logo} className="w-12 h-12 rounded-2xl border border-slate-100 shadow-sm object-cover" alt="" />
                                            <div>
                                                <span className="text-base font-display font-bold text-slate-900 block leading-tight tracking-tight">{store.name}</span>
                                                <p className="text-[10px] text-slate-400 font-bold font-small-caps mt-1 tracking-wider">Owner: {store.owner}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="px-8 py-6">
                                        <div className="space-y-1.5">
                                            <div className="flex items-center gap-2">
                                                <MapPin className="w-3.5 h-3.5 text-slate-300" />
                                                <span className="text-xs font-bold text-slate-700">{store.zone}</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <Star className="w-3.5 h-3.5 text-amber-400 fill-amber-400" />
                                                <span className="text-[11px] font-black text-slate-900">{store.rating}</span>
                                                <span className="text-[10px] text-slate-400 font-bold">â€¢ {store.totalOrders} Orders</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="px-8 py-6">
                                        <div className={cn(
                                            "inline-flex items-center gap-2 px-3 py-1.5 rounded-xl text-[10px] font-bold font-small-caps tracking-widest border",
                                            store.inventoryStatus === 'Up to Date' ? "bg-emerald-50 text-emerald-600 border-emerald-100/50" :
                                                store.inventoryStatus === 'Low Stock' ? "bg-amber-50 text-amber-600 border-amber-100/50" :
                                                    "bg-red-50 text-red-600 border-red-100/50"
                                        )}>
                                            <div className={cn(
                                                "w-1.5 h-1.5 rounded-full",
                                                store.inventoryStatus === 'Up to Date' ? "bg-emerald-500" :
                                                    store.inventoryStatus === 'Low Stock' ? "bg-amber-500 animate-pulse" : "bg-red-500 animate-ping"
                                            )} />
                                            {store.inventoryStatus}
                                        </div>
                                    </td>
                                    <td className="px-8 py-6">
                                        <div className="space-y-1">
                                            <p className="text-base font-display font-black text-slate-900 tracking-tight">{store.earnings}</p>
                                            <p className="text-[9px] text-primary font-black uppercase tracking-widest">{store.commission} Comm.</p>
                                        </div>
                                    </td>
                                    <td className="px-8 py-6">
                                        <span className={cn(
                                            "px-4 py-1.5 rounded-xl text-[10px] font-bold font-small-caps tracking-widest uppercase border",
                                            store.status === 'Active' ? "bg-emerald-50 text-emerald-600 border-emerald-100" :
                                                store.status === 'Pending' ? "bg-amber-50 text-amber-600 border-amber-100" :
                                                    "bg-red-50 text-red-600 border-red-100"
                                        )}>
                                            {store.status}
                                        </span>
                                    </td>
                                    <td className="px-8 py-6">
                                        <div className="flex items-center gap-2">
                                            <button className="p-2.5 hover:bg-slate-50 text-slate-300 rounded-xl transition-all border border-transparent hover:border-slate-100 hover:text-primary">
                                                <Eye className="w-5 h-5" />
                                            </button>
                                            <button className="p-2.5 hover:bg-slate-50 text-slate-300 rounded-xl transition-all border border-transparent hover:border-slate-100 hover:text-emerald-500">
                                                <TrendingUp className="w-5 h-5" />
                                            </button>
                                            <button className="p-2.5 hover:bg-slate-50 text-slate-300 rounded-xl transition-all border border-transparent hover:border-slate-100 hover:text-slate-600">
                                                <MoreVertical className="w-5 h-5" />
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>

                {/* Pagination Footer */}
                <div className="px-8 py-5 border-t border-slate-50 flex items-center justify-between bg-slate-50/30">
                    <p className="text-[11px] text-slate-400 font-bold font-small-caps tracking-widest uppercase">Showing 1-10 of 1,240 stores</p>
                    <div className="flex items-center gap-2">
                        <button className="px-4 py-2 bg-white border border-slate-200 rounded-lg text-[10px] font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">Previous</button>
                        <button className="px-4 py-2 bg-slate-900 text-white rounded-lg text-[10px] font-bold hover:bg-slate-800 transition-all shadow-sm">Next</button>
                    </div>
                </div>
            </div>
        </div>
    );
};

interface KPICardProps {
    title: string;
    value: string;
    icon: React.ReactNode;
    trend: string;
    color: 'primary' | 'orange' | 'emerald' | 'blue';
}

const StoreKPICard: React.FC<KPICardProps> = ({ title, value, icon, trend, color }) => (
    <div className="bg-white p-8 rounded-[38px] shadow-soft border border-slate-100 hover:shadow-xl hover:scale-[1.02] transition-all duration-500 group">
        <div className="flex justify-between items-start mb-6">
            <div className={cn(
                "w-14 h-14 rounded-2xl flex items-center justify-center transition-all duration-500 group-hover:scale-110 shadow-lg",
                color === 'primary' ? "bg-primary/10 text-primary shadow-primary/10" :
                    color === 'orange' ? "bg-amber-100 text-amber-600 shadow-amber-100/30" :
                        color === 'emerald' ? "bg-emerald-100 text-emerald-600 shadow-emerald-100/30" :
                            "bg-blue-100 text-blue-600 shadow-blue-100/30"
            )}>
                {React.cloneElement(icon as React.ReactElement, { className: "w-7 h-7" })}
            </div>
            <ArrowUpRight className="w-6 h-6 text-slate-200 group-hover:text-primary transition-colors" />
        </div>
        <div>
            <p className="text-[11px] font-bold text-slate-400 font-small-caps tracking-[0.2em] mb-1.5 uppercase">{title}</p>
            <h3 className="text-3xl font-display font-black text-slate-950 tracking-tight mb-2.5">{value}</h3>
            <p className={cn(
                "inline-flex items-center gap-1.5 text-[10px] font-bold font-small-caps tracking-tighter px-2.5 py-1 rounded-lg",
                color === 'emerald' ? "bg-emerald-50 text-emerald-600" : "bg-slate-50 text-slate-500"
            )}>
                {trend}
            </p>
        </div>
    </div>
);
